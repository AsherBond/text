/*! For license information please see src_helpers_files_js.js.LICENSE.txt */
"use strict";(self.webpackChunk_nextcloud_text=self.webpackChunk_nextcloud_text||[]).push([["src_helpers_files_js"],{94091:(e,n,o)=>{o.d(n,{Lz:()=>u,registerFileActionFallback:()=>p});o(69183);var s=o(5656),i=o(79753),a=o(42397),r=o(74411),c=o(25030),l=(o(77958),o(64024),o(47845),o(43935));o(19611);const d="Edit with text app",u=function(e,t){const n=e.split("/"),o=t.split("/");for(n.pop();n[0]===o[0];)if(n.shift(),o.shift(),0===n.length&&0===o.length)return".";const s=n.fill("..").concat(o),i=t.split("/");return s.length<i.length?s.join("/"):t},p=()=>{const e=(0,a.a)(),n=document.querySelector("#preview table.files-filestable");if(!e||!n){const n=document.createElement("div");n.id="text-viewer-fallback",document.body.appendChild(n);const s=s=>OCA.Files.fileActions.register(s,d,OC.PERMISSION_UPDATE|OC.PERMISSION_READ,(0,i.hp)("core","actions/rename"),(t=>{const s=window.FileList.findFile(t);Promise.all([Promise.resolve().then(o.bind(o,20144)),Promise.all([o.e("vendors-node_modules_nextcloud_vue_dist_index_mjs"),o.e("files-modal")]).then(o.bind(o,49142))]).then((o=>{const i=window.FileList.getCurrentDirectory()+"/"+t,a=o[0].default;a.prototype.t=window.t,a.prototype.n=window.n,a.prototype.OCA=window.OCA;const r=o[1].default;new a({render:function(t){const n=this;return t(r,{props:{fileId:s?s.id:null,active:!0,shareToken:e,relativePath:i,mimeType:s.mimetype},on:{close:function(){n.$destroy()}}})}}).$mount(n)}))}),t("text","Edit"));for(let e=0;e<r.SP.length;e++)s(r.SP[e]),OCA.Files.fileActions.setDefault(r.SP[e],d)}};let m=!1;let h=null;new s.h4({id:"workspace",order:10,enabled:(e,t)=>"files"===t.id,async render(e,t,n){h&&(h.$destroy(),h=null);const s=!!t.attributes["rich-workspace-file"]||!!m,i=m?(0,l.dirname)(m.path):t.path,a=m?"":t.attributes["rich-workspace"];m=!1;const{default:r}=await Promise.all([o.e("mermaid"),o.e("vendors-node_modules_nextcloud_vue_dist_index_mjs"),o.e("vendors-node_modules_braintree_sanitize-url_dist_index_js-node_modules_quartzy_markdown-it-me-a38efe"),o.e("src_extensions_index_js-src_components_Editor_EditorOutline_vue-data_image_svg_xml_base64_PHN-ffd735"),o.e("src_views_RichWorkspace_vue-node_modules_nextcloud_vue_dist_Functions_emoji_mjs-node_modules_-0e99a0")]).then(o.bind(o,22561));Promise.resolve().then(o.bind(o,20144)).then((t=>{e.id="files-workspace-wrapper";const n=t.default;n.prototype.t=window.t,n.prototype.n=window.n,n.prototype.OCA=window.OCA;const o=n.extend(r);h=new o({propsData:{path:i,hasRichWorkspace:s,content:a},store:c.default}).$mount(e)}))},updated(e,t){m=!1;const n=!!e.attributes["rich-workspace-file"];h.path=e.path,h.hasRichWorkspace=n,h.content=e.attributes["rich-workspace"]}})},74411:(e,t,n)=>{var o,s;n.d(t,{SP:()=>a});const i=["text/plain","application/cmd","application/x-empty","application/x-msdos-program","application/javascript","application/json","application/x-perl","application/x-php","application/x-tex","application/xml","application/yaml","text/asciidoc","text/css","text/html","text/org","text/x-c","text/x-c++src","text/x-h","text/x-java-source","text/x-ldif","text/x-python","text/x-shellscript"];null!==(o=OC.appswebroots)&&void 0!==o&&o.richdocuments||null!==(s=OC.appswebroots)&&void 0!==s&&s.onlyoffice||i.push("text/csv");const a=["text/markdown",...i]},42397:(e,t,n)=>{n.d(t,{a:()=>o});const o=()=>document.getElementById("sharingToken")?document.getElementById("sharingToken").value:null},25030:(e,t,n)=>{n.d(t,{default:()=>v,D:()=>f});var o=n(20144),s=n(20629),i=n(62556),a=n(79753),r=n(47845);const c="SET_VIEW_WIDTH",l="SET_SHOW_AUTHOR_ANNOTATIONS",d="SET_CURRENT_SESSION",u="SET_HEADINGS",p="SET_ATTACHMENT_LIST";var m=n(20296),h=n.n(m);const _=()=>document.documentElement.clientWidth,x=e=>{let{commit:t}=e;const n=h()((()=>{t("text/".concat(c),_())}),100);window.addEventListener("resize",n)},w=(0,i.Kc)("text").persist().build();o.default.use(s.ZP);const f={state:{showAuthorAnnotations:"true"===w.getItem("showAuthorAnnotations"),currentSession:w.getItem("currentSession"),viewWidth:_(),headings:Object.freeze([]),attachmentList:[]},getters:{imageAttachments:e=>e.attachmentList.filter((e=>e.isImage)),findAttachment:e=>t=>e.attachmentList.find((e=>e.name===t))},mutations:{[c](e,t){e.viewWidth=t},[l](e,t){e.showAuthorAnnotations=t,w.setItem("showAuthorAnnotations",""+t)},[d](e,t){e.currentSession=t,w.setItem("currentSession",t)},[u](e,t){if(e.headings.length!==t.length)return void(e.headings=Object.freeze(t));const n=e.headings,o=t.map(((e,t)=>{const o=n[t].level;return Object.freeze({...e,previous:o})}));e.headings=Object.freeze(o)},[p](e,t){e.attachmentList=t}},actions:{setShowAuthorAnnotations(e,t){let{commit:n}=e;n(l,t)},setCurrentSession(e,t){let{commit:n}=e;n(d,t)},setHeadings(e,t){let{commit:n}=e;n(u,t)},async setAttachmentList(e,t){var n,o,s,i;let{commit:c,state:l}=e,{documentId:d,shareToken:u}=t;const m=await r.Z.post((0,a.nu)("/apps/text/attachments"),{documentId:null!==(n=null===(o=l.currentSession)||void 0===o?void 0:o.documentId)&&void 0!==n?n:d,sessionId:null===(s=l.currentSession)||void 0===s?void 0:s.id,sessionToken:null===(i=l.currentSession)||void 0===i?void 0:i.token,shareToken:u});c(p,m.data)}}},v=new s.yh({plugins:[x],modules:{text:{namespaced:!0,...f}}})}}]);
//# sourceMappingURL=src_helpers_files_js.js.map?v=d3a3d935cda309c3528e