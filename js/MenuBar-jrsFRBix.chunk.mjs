import{b as E,r as C,c as y,s as U,p as I,i as V,h as st,w as at,u as P}from"./vue.runtime.esm-DkkA6hvG.chunk.mjs";import{B as $,q as B,u as j,A as ot,D as q,G as rt,r as lt,H as ct,I as dt,O as W,J as ut,K as ht,E as pt,b as mt,L as M,Q as _t,S as z,T as vt,U as ft,V as bt,W as gt,X as yt,Y as xt,Z as kt,_ as Ct,$ as At,a0 as Et,a1 as Mt,a2 as L,a3 as wt}from"./EditorOutline-Bn73PLDW.chunk.mjs";import{n as J,G as Q,t as k,c as w,f as R}from"./NcLoadingIcon-BH7hGc73.chunk.mjs";import{n as m}from"./_plugin-vue2_normalizer-XSZyZ-Zg.chunk.mjs";import{_ as x,U as St}from"./index-CCUE3e_p.chunk.mjs";import{g as Ot}from"./emoji-picker-DwlFXcXb.chunk.mjs";import{u as Tt,S as It,c as Nt,d as Pt,b as $t,e as Bt,f as Ft}from"./MediaHandler.provider-BkVIW0cW.chunk.mjs";import{s as G,e as F,a as Ut,u as Wt}from"./index-CBjMXwUt.chunk.mjs";import{N as Lt,h as Rt,u as Y,d as Dt,c as Ht,s as A}from"./NcNoteCard-C6xb7vi0-Dte9AMhR.chunk.mjs";import{l as S}from"./logger-C5ZHccIX.chunk.mjs";import{l as Z}from"./index-B8nYQ_zQ.chunk.mjs";import{u as Kt}from"./NcCheckboxRadioSwitch-BIEYfWtF-BCkZJMwl.chunk.mjs";const Vt=E({name:"NcDialog",components:{NcDialogButton:Rt,NcModal:Lt},props:{name:{type:String,required:!0},message:{type:String,default:""},additionalTrapElements:{type:Array,validator:e=>Array.isArray(e)&&e.every(i=>typeof i=="string"||i instanceof HTMLElement),default:()=>[]},container:{type:String,required:!1,default:"body"},open:{type:Boolean,default:!0},size:{type:String,required:!1,default:"small",validator:e=>typeof e=="string"&&["small","normal","large","full"].includes(e)},buttons:{type:Array,required:!1,default:()=>[],validator:e=>Array.isArray(e)&&e.every(i=>typeof i=="object")},noClose:{type:Boolean,default:!1},canClose:{type:Boolean,default:!0},closeOnClickOutside:{type:Boolean,default:!1},isForm:{type:Boolean,default:!1},outTransition:{type:Boolean,default:!1},navigationClasses:{type:[String,Array,Object],required:!1,default:""},navigationAriaLabel:{type:String,required:!1,default:""},navigationAriaLabelledby:{type:String,required:!1,default:""},contentClasses:{type:[String,Array,Object],required:!1,default:""},dialogClasses:{type:[String,Array,Object],required:!1,default:""}},emits:["closing","update:open","submit"],setup(e,{emit:i,slots:n}){const s=C(),{width:a}=Y(s,{width:900}),o=y(()=>a.value<876),c=y(()=>n?.navigation!==void 0),u=Q(),b=y(()=>e.navigationAriaLabel||void 0),O=y(()=>{if(!e.navigationAriaLabel)return e.navigationAriaLabelledby||u}),d=C(),r=y(()=>e.isForm&&!c.value?"form":"div"),l=y(()=>r.value==="form"?{submit(p){p.preventDefault(),i("submit",p)},reset(p){p.preventDefault(),i("reset",p)}}:{}),_=C(!0);function f(p,nt){(p.type==="submit"||p.nativeType==="submit")&&r.value==="form"&&!d.value.reportValidity()||(v(nt),window.setTimeout(()=>g(),300))}const v=p=>{_.value=!1,i("closing",p)},g=()=>{_.value=!0,i("update:open",!1)},h=y(()=>({noClose:e.noClose||!e.canClose,container:e.container===void 0?"body":e.container,labelId:u,size:e.size,show:e.open&&_.value,outTransition:e.outTransition,closeOnClickOutside:e.closeOnClickOutside,additionalTrapElements:e.additionalTrapElements}));return{dialogElement:d,dialogListeners:l,dialogTagName:r,handleButtonClose:f,handleClosing:v,handleClosed:g,hasNavigation:c,navigationId:u,navigationAriaLabelAttr:b,navigationAriaLabelledbyAttr:O,isNavigationCollapsed:o,modalProps:h,wrapper:s}}});var jt=function(){var e=this,i=e._self._c;return e._self._setupProxy,e.open?i("NcModal",e._b({staticClass:"dialog__modal",attrs:{"enable-slideshow":!1,"enable-swipe":!1},on:{close:e.handleClosed,"update:show":function(n){return e.handleClosing()}}},"NcModal",e.modalProps,!1),[i("h2",{staticClass:"dialog__name",attrs:{id:e.navigationId},domProps:{textContent:e._s(e.name)}}),i(e.dialogTagName,e._g({ref:"dialogElement",tag:"component",staticClass:"dialog",class:e.dialogClasses},e.dialogListeners),[i("div",{ref:"wrapper",class:["dialog__wrapper",{"dialog__wrapper--collapsed":e.isNavigationCollapsed}]},[e.hasNavigation?i("nav",{staticClass:"dialog__navigation",class:e.navigationClasses,attrs:{"aria-label":e.navigationAriaLabelAttr,"aria-labelledby":e.navigationAriaLabelledbyAttr}},[e._t("navigation",null,{isCollapsed:e.isNavigationCollapsed})],2):e._e(),i("div",{staticClass:"dialog__content",class:e.contentClasses},[e._t("default",function(){return[i("p",{staticClass:"dialog__text"},[e._v(" "+e._s(e.message)+" ")])]})],2)]),i("div",{staticClass:"dialog__actions"},[e._t("actions",function(){return e._l(e.buttons,function(n,s){return i("NcDialogButton",e._b({key:s,on:{click:(a,o)=>e.handleButtonClose(n,o)}},"NcDialogButton",n,!1))})})],2)])],1):e._e()},qt=[],zt=J(Vt,jt,qt,!1,null,"49ff4e77");const Jt=zt.exports,Qt={name:"NcActionButton",components:{NextcloudVueNcActionButton:B},extends:$,mounted(){this.editor?.on("transaction",()=>this.updateState())},methods:{runAction(){const{actionEntry:e}=this;e.click?e.click(this):e.action(this.editor?.chain().focus(),this.editor)?.run(),this.$nextTick(()=>{this.$emit("trigged",{...e})})}}};var Gt=function(){var e=this,i=e._self._c;return i("NextcloudVueNcActionButton",e._g({staticClass:"entry-single-action entry-action entry-action-item",class:e.state.class,attrs:{title:e.listItemTooltip||void 0,disabled:e.state.disabled,"aria-keyshortcuts":e.keyshortcuts||void 0,"data-text-action-entry":e.actionEntry.key,type:e.state.type,"model-value":e.state.type!=="button"?e.state.active:void 0,"close-after-click":""},on:{click:e.runAction},scopedSlots:e._u([{key:"icon",fn:function(){return[i(e.icon,{tag:"component"})]},proxy:!0}])},e.$listeners),[e._v(" "+e._s(e.label)+" ")])},Yt=[],Zt=m(Qt,Gt,Yt,!1,null,null);const Xt=Zt.exports,te={name:"ActionList",components:{NcActions:Dt,NcActionSeparator:q,ActionListItem:Xt},extends:$,mixins:[j,ot],props:{forceEnabled:{type:Boolean,default:!1}},data:()=>({visible:!1,hasEnabledChild:!0}),computed:{currentChild(){const{state:e,editor:i,actionEntry:{children:n}}=this;return e.active?n.find(s=>ct(s,i)):null},icon(){return this.currentChild?this.currentChild.icon:this.actionEntry.icon},iconKey(){return`${this.actionEntry.key}/${this.activeKey}`},activeKey(){return this.currentChild?.key},children(){return this.actionEntry.children.filter(({visible:e})=>e===void 0?!0:typeof e=="function"?e(this):e)},labelWithSelected(){return this.currentChild?k("text",'{menuItemName}, "{selectedSubMenuItemName}" is selected',{menuItemName:this.actionEntry.label,selectedSubMenuItemName:this.currentChild.label}):this.actionEntry.label},isEnabled(){return this.forceEnabled||this.hasEnabledChild}},mounted(){this.$_updateState=lt(this.checkStateOfChildren.bind(this),50),this.editor?.on("update",this.$_updateState),this.editor?.on("selectionUpdate",this.$_updateState)},beforeDestroy(){this.editor?.off("update",this.$_updateState),this.editor?.off("selectionUpdate",this.$_updateState)},methods:{onOpenChange(e){this.visible=e},runAction(){},onTrigger(e){e?.click||(this.editor?.chain().focus().run(),this.$emit("trigged",e))},checkStateOfChildren(){this.hasEnabledChild=this.children.some(e=>this.isChildEnabled(e))},isChildEnabled(e){return!e.isSeparator&&!rt(e,this.editor).disabled}}};var ee=function(){var e=this,i=e._self._c;return i("NcActions",e._b({staticClass:"entry-list-action entry-action",attrs:{title:e.tooltip,container:e.menuIDSelector,"aria-label":e.labelWithSelected,type:e.state.active?"primary":"tertiary","force-menu":!0,"data-text-action-entry":e.actionEntry.key,"data-text-action-active":e.activeKey,disabled:!e.isEnabled},on:{"update:open":e.onOpenChange},scopedSlots:e._u([{key:"icon",fn:function(){return[i(e.icon,{key:e.iconKey,tag:"component"})]},proxy:!0}])},"NcActions",e.state,!1),[e._l(e.children,function(n){return[n.isSeparator?i("NcActionSeparator",{key:`child-${n.key}`}):i("ActionListItem",e._g({key:`child-${n.key}`,attrs:{active:e.currentChild?.key===n.key,"is-item":"","action-entry":n},on:{trigged:e.onTrigger}},e.$listeners))]}),e._t("lastAction",null,null,{visible:e.visible})],2)},ie=[],ne=m(te,ee,ie,!1,null,null);const X=ne.exports,se={name:"ActionSingle",components:{NcButton:Ht},extends:$,props:{isItem:{type:Boolean,default:!1}},mounted(){this.editor?.on("transaction",()=>this.updateState())},methods:{runAction(){const{actionEntry:e}=this;e.click?e.click(this):e.action(this.editor?.chain().focus(),this.editor)?.run(),this.$nextTick(()=>{this.$emit("trigged",{...e})})}}};var ae=function(){var e=this,i=e._self._c;return i("NcButton",e._g({staticClass:"entry-single-action entry-action",class:e.state.class,attrs:{disabled:e.state.disabled,"aria-keyshortcuts":e.keyshortcuts||void 0,"data-text-action-entry":e.actionEntry.key,"aria-label":e.label,title:e.tooltip,type:"tertiary",pressed:e.state.type!=="button"?e.state.active:void 0},on:{click:e.runAction},scopedSlots:e._u([{key:"icon",fn:function(){return[i(e.icon,{tag:"component"})]},proxy:!0},e.actionEntry.forceLabel?{key:"default",fn:function(){return[e._v(" "+e._s(e.label)+" ")]},proxy:!0}:null],null,!0)},e.$listeners))},oe=[],re=m(se,ae,oe,!1,null,null);const tt=re.exports,et=E({data(){return{activeMenuEntry:0,entries:[]}},computed:{visibleEntries(){return this.entries}},watch:{visibleEntries(){this.$nextTick(()=>{(this.activeMenuEntry>this.visibleEntries.length||this.visibleEntries[this.activeMenuEntry]?.disabled)&&this.setNextMenuEntry()})}},methods:{disableMenuEntry(e,i){const n=this.visibleEntries.findIndex(({key:s})=>s===e);this.visibleEntries[n].disabled=i,i===!1&&this.activeMenuEntry===n&&this.$nextTick(()=>this.setNextMenuEntry())},setNextMenuEntry(){const e=this.visibleEntries.length+(this.$refs.remainingEntries?1:0);do this.activeMenuEntry=(this.activeMenuEntry+1)%e;while(this.activeMenuEntry<this.visibleEntries.length&&this.visibleEntries[this.activeMenuEntry].disabled)},setPreviousMenuEntry(){const e=this.visibleEntries.length+(this.$refs.remainingEntries?1:0);do{const i=this.activeMenuEntry-1;this.activeMenuEntry=(i%e+e)%e}while(this.activeMenuEntry<this.visibleEntries.length&&this.visibleEntries[this.activeMenuEntry].disabled)},handleToolbarNavigation(e){e.key==="ArrowRight"?this.setNextMenuEntry():e.key==="ArrowLeft"&&this.setPreviousMenuEntry(),this.activeMenuEntry===this.visibleEntries.length?this.$refs.remainingEntries?.focusButton?.():[...this.$refs.menuEntries].sort((i,n)=>this.visibleEntries.findIndex(({key:s})=>s===i.$vnode.data.key)-this.visibleEntries.findIndex(({key:s})=>s===n.$vnode.data.key))[this.activeMenuEntry].focusButton()}}}),le=E({name:"ReadonlyBar",components:{ActionList:X,ActionSingle:tt},extends:et,props:{openReadOnly:{type:Boolean,default:!1}},data(){return{entries:this.openReadOnly?[...dt,...W]:[...W]}},methods:{t:k}});var ce=function(){var e=this,i=e._self._c;return e._self._setupProxy,i("div",{staticClass:"text-readonly-bar",attrs:{"data-text-el":"readonly-bar"}},[i("div",{ref:"menubar",staticClass:"text-readonly-bar__entries",attrs:{role:"toolbar","aria-label":e.t("text","Editor actions")}},e._l(e.visibleEntries,function(n,s){return i(n.component?n.component:n.children?"ActionList":"ActionSingle",{key:n.key,ref:"menuEntries",refInFor:!0,tag:"component",attrs:{"action-entry":n,"can-be-focussed":e.activeMenuEntry===s},on:{disabled:function(a){return e.disableMenuEntry(n.key,a)}}})}),1),i("div",{staticClass:"text-menubar__slot"},[e._t("default")],2)])},de=[],ue=m(le,ce,de,!1,null,"24e350a2");const Pi=ue.exports,it=Symbol("text:connection");function $i(e){const i=U(void 0),n=U(void 0),s=async()=>{const a=localStorage.getItem("nick")??"",{connection:o,data:c}=pe(e)||await ut({fileId:e.fileId,guestName:a,token:e.shareToken,filePath:e.relativePath,baseVersionEtag:i.value});return i.value=c.document.baseVersionEtag,n.value=o,c};return I(it,n),{connection:n,openConnection:s,baseVersionEtag:i}}const he=()=>({connection:V(it)});function pe(e){if(e.initialSession){const{document:i,session:n}=e.initialSession;return{connection:{documentId:i.id,sessionId:n.id,sessionToken:n.token,baseVersionEtag:i.baseVersionEtag,filePath:e.relativePath,shareToken:e.shareToken},data:e.initialSession}}}let D=Z("text","is_full_width_editor",!1);const N=Symbol("text:editor:width");function me(){const e=getComputedStyle(document.body).getPropertyValue("--text-editor-max-width"),i=document.documentElement.style.getPropertyValue("--text-editor-max-width");return!!e&&e!==i}const Bi=()=>{if(me())return I(N,null),{applyEditorWidth:()=>{}};const e=C(D);I(N,st(e)),G("text:editor:full-width",({value:s})=>{D=s,e.value=s});const i=y(()=>e.value?"100%":"80ch"),n=()=>{document.documentElement.style.setProperty("--text-editor-max-width",i.value)};return at(i,n),{applyEditorWidth:n}},_e=()=>{const e=V(N);return e===null?{canToggleWidth:!1}:{canToggleWidth:!0,isFullWidth:e,setFullWidth:i=>{w.post(x("/apps/text/settings"),{key:"is_full_width_editor",value:i?"1":"0"}),F("text:editor:full-width",{value:i})}}},ve={name:"NcActionCheckbox",mixins:[ht],inject:{isInSemanticMenu:{from:"NcActions:isSemanticMenu",default:!1}},model:{prop:"modelValue",event:"update:modelValue"},props:{id:{type:String,default:()=>"action-"+Q(),validator:e=>e.trim()!==""},checked:{type:Boolean,default:void 0},modelValue:{type:Boolean,default:!1},value:{type:[String,Number],default:""},disabled:{type:Boolean,default:!1}},emits:["change","check","uncheck","update:checked","update:modelValue","update:model-value"],setup(){return{model:Kt("checked","update:checked")}},computed:{isFocusable(){return!this.disabled},ariaChecked(){if(this.isInSemanticMenu)return this.model?"true":"false"}},methods:{checkInput(e){this.$refs.label.click()},onChange(e){this.model=this.$refs.checkbox.checked,this.$emit("change",e),this.$refs.checkbox.checked?this.$emit("check"):this.$emit("uncheck")}}};var fe=function(){var e=this,i=e._self._c;return i("li",{staticClass:"action",class:{"action--disabled":e.disabled},attrs:{role:e.isInSemanticMenu&&"presentation"}},[i("span",{staticClass:"action-checkbox",attrs:{role:e.isInSemanticMenu&&"menuitemcheckbox","aria-checked":e.ariaChecked}},[i("input",{ref:"checkbox",staticClass:"checkbox action-checkbox__checkbox",class:{focusable:e.isFocusable},attrs:{id:e.id,disabled:e.disabled,type:"checkbox"},domProps:{checked:e.model,value:e.value},on:{keydown:function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"enter",13,n.key,"Enter")||n.ctrlKey||n.shiftKey||n.altKey||n.metaKey?null:(n.preventDefault(),e.checkInput.apply(null,arguments))},change:e.onChange}}),i("label",{ref:"label",staticClass:"action-checkbox__label",attrs:{for:e.id}},[e._v(e._s(e.text))]),e._e()],2)])},be=[],ge=J(ve,fe,be,!1,null,"96242645");const ye=ge.exports;var T={exports:{}},H;function xe(){return H||(H=1,function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;function n(d){"@babel/helpers - typeof";return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},n(d)}var s=47,a=46,o=function(d){var r=n(d);if(r!=="string")throw new TypeError("Expected a string, got a ".concat(r))},c=function(d,r){for(var l="",_=0,f=-1,v=0,g,h=0;h<=d.length;++h){if(h<d.length)g=d.charCodeAt(h);else{if(g===s)break;g=s}if(g===s){if(!(f===h-1||v===1))if(f!==h-1&&v===2){if(l.length<2||_!==2||l.charCodeAt(l.length-1)!==a||l.charCodeAt(l.length-2)!==a){if(l.length>2){var p=l.lastIndexOf("/");if(p!==l.length-1){p===-1?(l="",_=0):(l=l.slice(0,p),_=l.length-1-l.lastIndexOf("/")),f=h,v=0;continue}}else if(l.length===2||l.length===1){l="",_=0,f=h,v=0;continue}}r&&(l.length>0?l+="/..":l="..",_=2)}else l.length>0?l+="/"+d.slice(f+1,h):l=d.slice(f+1,h),_=h-f-1;f=h,v=0}else g===a&&v!==-1?++v:v=-1}return l},u=function(d){try{return decodeURIComponent(d)}catch{return d}},b=function(d){o(d);var r=d;if(r.length===0)return".";var l=r.charCodeAt(0)===s,_=r.charCodeAt(r.length-1)===s;return r=u(r),r=c(r,!l),r.length===0&&!l&&(r="."),r.length>0&&_&&(r+="/"),l?"/"+r:r},O=b;i.default=O,e.exports=i.default}(T,T.exports)),T.exports}var ke=xe();const Ce=Ot(ke);class Fi{#t;#e;#i;#n;#s;#a;#o=[];constructor({session:i,user:n,shareToken:s,currentDirectory:a,fileId:o}){this.#t=i,this.#e=n,this.#i=s,this.#n=a,this.#s=o??i.documentId,this.#a=this.#r()}async#r(){const i=await w.post(x("/apps/text/attachments"),{documentId:this.#t?.documentId??this.#s,sessionId:this.#t?.id,sessionToken:this.#t?.token,shareToken:this.#i});this.#o=i.data}#l(i){return this.#o.find(n=>n.name===i)}async resolve(i,n=!0){let s;const a=/^\.attachments\.\d+\//;if(i.match(a)){const o=decodeURIComponent(i.replace(a,"").split("?")[0]);if(await this.#a,s=this.#l(o),n&&!s&&(await this.#r(),s=this.#l(o)),s)return s}return Ae(i)?{isImage:!0,name:this.#c(i),previewUrl:i,fullUrl:i}:{isImage:!0,name:this.#c(i),previewUrl:this.#d(i),fullUrl:this.#d(i)}}#c(i){return i.split("/").pop()}#d(i){if(this.#e){const o=this.#e.uid,c=this.#u(i).split("/").map(encodeURIComponent).join("/");return St(`dav/files/${o}${c}`)}const n=this.#u(i).split("/"),s=n.pop(),a=n.join("/");return x("/s/{token}/download?path={dirname}&files={basename}",{token:this.#i,basename:s,dirname:a})}#h(i){return decodeURI(i.split("?")[0])}#u(i){const n=[this.#n,this.#h(i)].join("/");return Ce(n)}}function Ae(e){return e.startsWith("http://")||e.startsWith("https://")||e.startsWith("data:")}const Ee={name:"ContentContainer",components:{EditorContent:mt,EditorOutline:pt},mixins:[j],setup(){const{editor:e}=M();return{editor:e}},computed:{showOutline(){return this.$outlineState.visible}}};var Me=function(){var e=this,i=e._self._c;return i("div",{staticClass:"content-wrapper text-editor__content-wrapper",class:{"--show-outline":e.showOutline},attrs:{"data-text-el":"editor-content-wrapper"}},[e.showOutline?i("div",{staticClass:"text-editor__content-wrapper__left"},[i("EditorOutline")],1):e._e(),e._t("default"),i("EditorContent",{staticClass:"editor__content text-editor__content",attrs:{role:"document",editor:e.editor}}),i("div",{staticClass:"text-editor__content-wrapper__right"})],2)},we=[],Se=m(Ee,Me,we,!1,null,"ea464798");const Ui=Se.exports;function Oe(e,i){const{documentId:n,sessionId:s,sessionToken:a,shareToken:o}=P(e),c=new FormData;c.append("file",i);const u=x("apps/text/attachment/upload?");return w.post(u,c,{headers:{"Content-Type":"multipart/form-data"},params:{documentId:n,sessionId:s,sessionToken:a,token:o}})}function Te(e,i){const{documentId:n,sessionId:s,sessionToken:a}=P(e),o=x("apps/text/attachment/create");return w.post(o,{documentId:n,sessionId:s,sessionToken:a,fileName:`${i.app}${i.extension}`})}function Ie(e,i){const{documentId:n,sessionId:s,sessionToken:a}=P(e),o=x("apps/text/attachment/filepath");return w.post(o,{documentId:n,sessionId:s,sessionToken:a,filePath:i})}const K=e=>e.split("/").slice(0,-1).join("/"),Ne={name:"MediaHandler",mixins:[Tt],provide(){const e={};return Object.defineProperties(e,{[$t]:{get:()=>this.showAttachmentPrompt},[Pt]:{get:()=>this.chooseLocalFile},[Nt]:{get:()=>this.createAttachment},[It]:{get:()=>this.state}}),e},setup(){const{connection:e}=he(),i=_t(),{editor:n}=M();return{connection:e,editor:n,isMobile:i}},data(){return{lastFilePath:null,draggedOver:!1,state:{isUploadingAttachments:!1}}},computed:{initialFilePath(){return this.lastFilePath??K(this.$file?.relativePath??"/")}},methods:{setDraggedOver(e){this.draggedOver=e},onPaste(e){this.uploadAttachmentFiles(e.detail.files)},onEditorDrop(e){this.uploadAttachmentFiles(e.detail.files,e.detail.position)},onAttachmentUploadFilePicked(e){this.uploadAttachmentFiles(e.target.files),e.target.value=""},chooseLocalFile(){this.$refs.attachmentFileInput.click()},async uploadAttachmentFiles(e,i=null){if(!e)return;this.state.isUploadingAttachments=!0;const n=[...e].map(s=>this.uploadAttachmentFile(s,i));return Promise.all(n).catch(s=>{S.error("Uploading multiple attachments failed",{error:s}),A(t("text","Uploading multiple attachments failed."))}).then(()=>{this.state.isUploadingAttachments=!1})},async uploadAttachmentFile(e,i=null){return this.state.isUploadingAttachments=!0,Oe(this.connection,e).then(n=>{this.insertAttachment(n.data?.name,n.data?.id,e.type,i,n.data?.dirname)}).catch(n=>{S.error("Uploading attachment failed",{error:n}),n.response?.data.error?A(t("text","Uploading attachment failed: {error}",{error:n.response.data.error})):A(t("text","Uploading attachment failed."))}).then(()=>{this.state.isUploadingAttachments=!1})},showAttachmentPrompt(){Ut()&&OC.dialogs.filepicker(t("text","Insert an attachment"),e=>{this.insertFromPath(e)},!1,[],!0,void 0,this.initialFilePath)},insertFromPath(e){return this.lastFilePath=K(e),this.state.isUploadingAttachments=!0,Ie(this.connection,e).then(i=>{this.insertAttachment(i.data?.name,i.data?.id,i.data?.mimetype,null,i.data?.dirname)}).catch(i=>{S.error("Failed to insert from Files",{error:i}),A(t("text","Failed to insert from Files"))}).then(()=>{this.state.isUploadingAttachments=!1})},createAttachment(e){return this.state.isUploadingAttachments=!0,Te(this.connection,e).then(i=>{this.insertAttachmentPreview(i.data?.id)}).catch(i=>{S.error("Failed to create attachment",{error:i}),A(t("text","Failed to create attachment"))}).then(()=>{this.state.isUploadingAttachments=!1})},insertAttachmentPreview(e){const i=new URL(x(`/f/${e}`),window.origin).href.replaceAll(" ","%20");this.editor.chain().focus().insertPreview(i).run()},insertAttachment(e,i,n,s=null,a=""){const o=a+"/"+encodeURIComponent(e).replace(/[!'()*]/g,b=>"%"+b.charCodeAt(0).toString(16).toUpperCase()),c=e.replaceAll(/[[\]]/g,"");(s?this.editor.chain().focus(s):this.editor.chain()).setImage({src:o,alt:c}).run();const u=this.editor.view.state.selection;u.empty||this.editor.commands.focus(u.to),this.editor.commands.scrollIntoView(),this.editor.commands.setMeta("insertedAttachmentSrc",{src:o}),F("text:image-node:add",null)}}};var Pe=function(){var e=this,i=e._self._c;return i("div",{staticClass:"editor editor-media-handler",class:{draggedOver:e.draggedOver,"is-mobile":e.isMobile},attrs:{"data-text-el":"editor-media-handler"},on:{"image-paste":e.onPaste,dragover:function(n){return n.preventDefault(),n.stopPropagation(),e.setDraggedOver(!0)},dragleave:function(n){return n.preventDefault(),n.stopPropagation(),e.setDraggedOver(!1)},drop:function(n){return n.preventDefault(),n.stopPropagation(),e.setDraggedOver(!1)},"file-drop":e.onEditorDrop}},[i("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"attachmentFileInput",attrs:{"data-text-el":"attachment-file-input",type:"file",accept:"*/*",multiple:""},on:{change:e.onAttachmentUploadFilePicked}}),e._t("default")],2)},$e=[],Be=m(Ne,Pe,$e,!1,null,null);const Fe=Be.exports,Ue={name:"MainContainer",components:{MediaHandler:Fe},mixins:[Bt]};var We=function(){var e=this,i=e._self._c;return i("div",{staticClass:"editor"},[e.$editorUpload?i("MediaHandler",{staticClass:"text-editor__main"},[e._t("default")],2):e._t("default")],2)},Le=[],Re=m(Ue,We,Le,!1,null,"e0c9a19c");const Wi=Re.exports,De={name:"Wrapper",provide(){const e={};return Object.defineProperties(e,{[bt]:{get:()=>this.outline},[ft]:{get:()=>({toggle:this.outlineToggle})},[vt]:{get:()=>({toggle:this.readOnlyToggle})}}),e},props:{isResolvingConflict:{type:Boolean,default:!1},hasConnectionIssue:{type:Boolean,default:!1},contentLoaded:{type:Boolean,default:!0},showOutlineOutside:{type:Boolean,default:!1}},setup(){const{isRichEditor:e,isRichWorkspace:i}=z();return{isRichEditor:e,isRichWorkspace:i}},data:()=>({outline:{visible:!1,enable:!1}}),computed:{showOutline(){return this.isAbleToShowOutline?this.outline.visible:!1},isAbleToShowOutline(){return!this.isRichWorkspace}},watch:{showOutlineOutside(){this.outline.visible=this.showOutlineOutside}},mounted(){G("text:keyboard:outline",this.outlineToggle),this.outline.enable=this.isAbleToShowOutline,this.$watch(()=>this.isAbleToShowOutline,e=>{Object.assign(this.outline,{enable:e})})},beforeDestroy(){Wt("text:keyboard:outline",this.outlineToggle)},methods:{outlineToggle(){this.outline.visible=!this.outline.visible,this.$emit("outline-toggled",this.outline.visible)},readOnlyToggle(){this.$emit("read-only-toggled")}}};var He=function(){var e=this,i=e._self._c;return i("div",{staticClass:"text-editor__wrapper",class:{"has-conflicts":e.isResolvingConflict,"is-rich-workspace":e.isRichWorkspace,"is-rich-editor":e.isRichEditor}},[e._t("default")],2)},Ke=[],Ve=m(De,He,Ke,!1,null,"ae654636");const Li=Ve.exports;function je(){return navigator?.userAgentData?.mobile!==void 0?navigator.userAgentData.mobile:[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/playbook/i,/silk/i,/BlackBerry/i,/Windows Phone/i].some(e=>navigator.userAgent.match(e))}const qe={name:"HelpModal",components:{NcDialog:Jt},data(){return{formatted:{bold:!0,italic:!0,strikethrough:!0,heading1:!0,heading6:!0,unorderdList:!0,orderedList:!0,checkList:!0,blockQuote:!0,codeBlock:!0},ctrlOrModKey:gt[yt.Mod]}},computed:{isFormatted(){return e=>this.formatted[e]},isMobileCached(){return this.isMobilePlatform()}},methods:{t:k,toggleFormatted(e){this.formatted[e]=!this.formatted[e]},isMobilePlatform:je}};var ze=function(){var e=this,i=e._self._c;return i("NcDialog",{attrs:{size:"large","data-text-el":"formatting-help",name:e.t("text","Formatting and shortcuts"),"close-on-click-outside":!0},on:{closing:function(n){return e.$emit("close")}}},[i("h2",[e._v(e._s(e.t("text","Formatting and shortcuts")))]),i("p",[e._v(e._s(e.t("text","Speed up your writing with simple shortcuts.")))]),e.isMobileCached?i("p",[e._v(" "+e._s(e.t("text","Just type the Markdown syntax from below."))+" ")]):i("p",[e._v(" "+e._s(e.t("text","Just type the Markdown syntax or use keyboard shortcuts from below."))+" ")]),i("table",[i("thead",[i("tr",[i("th",[e._v(e._s(e.t("text","Style")))]),i("th",[e._v(e._s(e.t("text","Syntax")))]),e.isMobileCached?e._e():i("th",[e._v(" "+e._s(e.t("text","Keyboard shortcuts"))+" ")])])]),i("tbody",[i("tr",[i("td",[e._v(e._s(e.t("text","New paragraph")))]),i("td",[i("kbd",[e._v(e._s(e.t("text","Enter")))])]),e.isMobileCached?e._e():i("td")]),i("tr",[i("td",[e._v(e._s(e.t("text","Hard line break")))]),i("td",[i("kbd",[e._v(e._s(e.t("text","Enter")))]),e._v(" "+e._s(e.t("text","followed by"))+" "),i("kbd",[e._v(e._s(e.t("text","Backspace")))])]),e.isMobileCached?e._e():i("td",[i("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),i("kbd",[e._v(e._s(e.t("text","Enter")))])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Bold")))]),i("td",[i("code",[e._v("**"+e._s(e.t("text","Bold text"))+"**")])]),e.isMobileCached?e._e():i("td",[i("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),i("kbd",[e._v("B")])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Italic")))]),i("td",[i("code",[e._v("*"+e._s(e.t("text","Italicized text"))+"*")])]),e.isMobileCached?e._e():i("td",[i("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),i("kbd",[e._v("I")])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Strikethrough")))]),i("td",[i("code",[e._v("~~"+e._s(e.t("text","Mistaken text"))+"~~")])]),e.isMobileCached?e._e():i("td",[i("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),i("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),i("kbd",[e._v("S")])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Underline")))]),i("td",[i("code",[e._v("__"+e._s(e.t("text","Underlined text"))+"__")])]),e.isMobileCached?e._e():i("td",[i("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),i("kbd",[e._v("U")])])]),i("tr",[i("td",{staticClass:"ellipsis_top"},[e._v(" "+e._s(e.t("text","Heading 1"))+" ")]),i("td",{staticClass:"ellipsis_top"},[i("code",[e._v("# "+e._s(e.t("text","Heading level 1")))])]),e.isMobileCached?e._e():i("td",{staticClass:"ellipsis_top"},[i("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),i("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),i("kbd",[e._v("1")])])]),i("tr",[i("td",{staticClass:"noborder ellipsis"},[e._v("…")]),i("td",{staticClass:"noborder ellipsis"},[e._v("…")]),e.isMobileCached?e._e():i("td",{staticClass:"ellipsis noborder"},[e._v("…")])]),i("tr",[i("td",{staticClass:"noborder ellipsis_bottom"},[e._v(" "+e._s(e.t("text","Heading 6"))+" ")]),i("td",{staticClass:"noborder ellipsis_bottom"},[i("code",[e._v("###### "+e._s(e.t("text","Heading level 6")))])]),e.isMobileCached?e._e():i("td",{staticClass:"noborder ellipsis_bottom"},[i("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),i("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),i("kbd",[e._v("6")])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Unordered list")))]),i("td",[i("code",[e._v("* "+e._s(e.t("text","An item")))])]),e.isMobileCached?e._e():i("td",[i("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),i("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),i("kbd",[e._v("8")])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Ordered list")))]),i("td",[i("code",[e._v("1. "+e._s(e.t("text","First item")))])]),e.isMobileCached?e._e():i("td",[i("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),i("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),i("kbd",[e._v("7")])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Checklist")))]),i("td",[i("code",[e._v("* [] "+e._s(e.t("text","To-Do item")))])]),e.isMobileCached?e._e():i("td",[i("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),i("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),i("kbd",[e._v("9")])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Blockquote")))]),i("td",[i("code",[e._v("> "+e._s(e.t("text","Quoted text")))])]),e.isMobileCached?e._e():i("td",[i("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),i("kbd",[e._v(">")])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Code block")))]),i("td",[i("code",[e._v("``` "+e._s(e.t("text","Some code")))])]),e.isMobileCached?e._e():i("td")]),i("tr",[i("td",[e._v(e._s(e.t("text","Link")))]),i("td",[i("code",[e._v("[Title](https://example.org)")])]),e.isMobileCached?e._e():i("td",[i("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),i("kbd",[e._v("K")])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Insert emoji")))]),i("td",[i("code",[e._v(":"+e._s(e.t("text","emoji")))])]),e.isMobileCached?e._e():i("td")]),i("tr",[i("td",[e._v(e._s(e.t("text","Mention someone")))]),i("td",[i("code",[e._v("@"+e._s(e.t("text","name")))])]),e.isMobileCached?e._e():i("td")]),i("tr",[i("td",[e._v(e._s(e.t("text","Smart picker")))]),i("td",[i("code",[e._v("/"+e._s(e.t("text","something")))])]),e.isMobileCached?e._e():i("td")])])]),i("table",{attrs:{vif:"!isMobileCached"}},[i("thead",[i("tr",[i("th",[e._v(e._s(e.t("text","Action")))]),i("th",[e._v(e._s(e.t("text","Keyboard shortcuts")))])])]),i("tbody",[i("tr",[i("td",[e._v(e._s(e.t("text","Undo")))]),i("td",[i("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),i("kbd",[e._v("Z")])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Redo")))]),i("td",[i("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),i("kbd",[e._v("Y")])])]),i("tr",[i("td",[e._v(e._s(e.t("text","Toggle outline")))]),i("td",[i("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),i("kbd",[e._v(e._s(e.t("text","Alt")))]),e._v(" + "),i("kbd",[e._v("H")])])])])])])},Je=[],Qe=m(qe,ze,Je,!1,null,"5bb25ea4");const Ge=Qe.exports,Ye=E({name:"NcActionButton",components:{NextcloudVueNcActionButton:B,Help:xt},methods:{t:k}});var Ze=function(){var e=this,i=e._self._c;return e._self._setupProxy,i("NextcloudVueNcActionButton",e._g({attrs:{"close-after-click":"","data-text-action-entry":"formatting-help"},scopedSlots:e._u([{key:"icon",fn:function(){return[i("Help")]},proxy:!0}])},e.$listeners),[e._v(" "+e._s(e.t("text","Formatting help"))+" ")])},Xe=[],ti=m(Ye,Ze,Xe,!1,null,null);const ei=ti.exports,ii=E({name:"CharacterCount",components:{AlphabeticalVariant:Ct,NcActionText:kt},props:{visible:Boolean},setup(){const{editor:e}=M(),i=C("");return{countString:i,refresh:()=>{const{storage:n,state:s}=e,a=n.characterCount.words({node:s.doc}),o=n.characterCount.characters({node:s.doc}),c=R("text","%n word","%n words",a),u=R("text","%n char","%n chars",o);i.value=[c,u].join(", "),console.debug({wordCount:a,charCount:o,countString:i.value})}}},watch:{visible:"refresh"},created(){this.refresh()}});var ni=function(){var e=this,i=e._self._c;return e._self._setupProxy,i("NcActionText",{attrs:{"data-text-action-entry":"character-count",name:e.countString},scopedSlots:e._u([{key:"icon",fn:function(){return[i("AlphabeticalVariant")]},proxy:!0}])})},si=[],ai=m(ii,ni,si,!1,null,null);const oi=ai.exports,ri={__name:"TranslateButton",setup(e){const{editor:i}=M(),n=Z("text","translation_languages",{});console.debug(n);const s=!!n.from?.length;return{__sfc:!0,editor:i,languages:n,canTranslate:s,showTranslate:()=>{const{commands:a,view:{state:o}}=i.value,{from:c,to:u}=o.selection;let b=o.doc.textBetween(c,u," ");b.trim().length||(a.selectAll(),b=o.doc.textContent),F("text:translate-modal:show",{content:b})},t:k,NcActionButton:B,TranslateVariant:At}}};var li=function(){var e=this,i=e._self._c,n=e._self._setupProxy;return n.canTranslate?i(n.NcActionButton,{attrs:{"close-after-click":""},on:{click:n.showTranslate},scopedSlots:e._u([{key:"icon",fn:function(){return[i(n.TranslateVariant)]},proxy:!0}],null,!1,1799497554)},[e._v(" "+e._s(n.t("text","Translate"))+" ")]):e._e()},ci=[],di=m(ri,li,ci,!1,null,null);const ui=di.exports,hi={__name:"WidthToggle",setup(e){const{canToggleWidth:i,isFullWidth:n,setFullWidth:s}=_e();return{__sfc:!0,canToggleWidth:i,isFullWidth:n,setFullWidth:s,t:k,NcActionCheckbox:ye}}};var pi=function(){var e=this,i=e._self._c,n=e._self._setupProxy;return n.canToggleWidth?i(n.NcActionCheckbox,{attrs:{checked:n.isFullWidth},on:{"update:checked":n.setFullWidth}},[e._v(" "+e._s(n.t("text","Full width editor"))+" ")]):e._e()},mi=[],_i=m(hi,pi,mi,!1,null,null);const vi=_i.exports,fi={name:"MenuBar",components:{ActionFormattingHelp:ei,ActionList:X,ActionSingle:tt,HelpModal:Ge,NcActionSeparator:q,CharacterCount:oi,TranslateButton:ui,WidthToggle:vi},extends:et,mixins:[Ft],provide(){const e={};return Object.defineProperties(e,{[wt]:{get:()=>this.randomID}}),e},props:{isHidden:{type:Boolean,default:!1},openReadOnly:{type:Boolean,default:!1}},setup(){const e=M(),{isRichEditor:i,isRichWorkspace:n}=z(),s=C(),{width:a}=Y(s);return{editor:e,isRichEditor:i,isRichWorkspace:n,menubar:s,width:a}},data(){return{entries:this.openReadOnly?[...Mt,...L]:[...L],randomID:`menu-bar-${Math.ceil(Math.random()*1e4+500).toString(16)}`,displayHelp:!1,isReady:!1,resize:null}},computed:{visibleEntries(){return this.entries.filter(({priority:e})=>e===void 0||e<=this.iconsLimit)},hiddenEntries(){const e=this.entries.filter(({priority:n})=>n!==void 0&&n>this.iconsLimit),i=e.reduce((n,s,a)=>{const o=s.children??[s];if(o.length>1){const c=n.length&&!n.at(-1).isSeparator?[{key:`separator-before-${s.id}`,isSeparator:!0}]:[],u=a!==e.length-1?[{key:`separator-after-${s.id}`,isSeparator:!0}]:[];return[...n,...c,...o,...u]}return[...n,...o]},[]);return{key:"remain",label:this.t("text","Remaining actions"),icon:Et,children:i}},iconWidth(){const e=(this.menubar&&getComputedStyle(this.menubar))?.getPropertyValue("--default-clickable-area");return parseInt(e)||34},iconsLimit(){const e=this.width-4,i=this.$isMobile?this.iconWidth:this.iconWidth+2;return Math.floor(e/i)-1}},mounted(){this.$nextTick(()=>{this.isReady=!0,this.$emit("update:loaded",!0)})},methods:{showHelp(){this.displayHelp=!0},hideHelp(){this.displayHelp=!1},t:k}};var bi=function(){var e=this,i=e._self._c;return i("div",{staticClass:"text-menubar",class:{"text-menubar--ready":e.isReady,"text-menubar--hide":e.isHidden,"text-menubar--is-workspace":e.isRichWorkspace,"is-mobile":e.$isMobile},attrs:{id:e.randomID,"data-text-el":"menubar",role:"region","aria-label":e.t("text","Editor actions")}},[e.displayHelp?i("HelpModal",{on:{close:e.hideHelp}}):e._e(),e.isRichEditor?i("div",{ref:"menubar",staticClass:"text-menubar__entries",attrs:{role:"toolbar","aria-label":e.t("text","Formatting menu bar")},on:{keyup:[function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&n.button!==0?null:(n.stopPropagation(),e.handleToolbarNavigation.apply(null,arguments))},function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"right",39,n.key,["Right","ArrowRight"])||"button"in n&&n.button!==2?null:(n.stopPropagation(),e.handleToolbarNavigation.apply(null,arguments))}]}},[e._l(e.visibleEntries,function(n,s){return i(n.component?n.component:n.children?"ActionList":"ActionSingle",{key:n.key,ref:"menuEntries",refInFor:!0,tag:"component",attrs:{"action-entry":n,"can-be-focussed":e.activeMenuEntry===s},on:{disabled:function(a){return e.disableMenuEntry(n.key,a)},click:function(a){e.activeMenuEntry=s}}})}),i("ActionList",{ref:"remainingEntries",attrs:{"action-entry":e.hiddenEntries,"can-be-focussed":e.activeMenuEntry===e.visibleEntries.length,"force-enabled":!0},on:{click:function(n){e.activeMenuEntry="remain"}},scopedSlots:e._u([{key:"lastAction",fn:function({visible:n}){return[i("TranslateButton"),i("WidthToggle"),i("ActionFormattingHelp",{on:{click:e.showHelp}}),i("NcActionSeparator"),i("CharacterCount",e._b({},"CharacterCount",{visible:n},!1))]}}],null,!1,2138617236)})],2):e._e(),i("div",{staticClass:"text-menubar__slot"},[e._t("default")],2)],1)},gi=[],yi=m(fi,bi,gi,!1,null,"a1de2021");const Ri=yi.exports;export{Fi as A,Ui as C,Wi as M,Jt as N,Pi as R,Li as W,Ri as a,Bi as b,$i as p};
//# sourceMappingURL=MenuBar-jrsFRBix.chunk.mjs.map
