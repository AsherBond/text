{"version":3,"file":"SessionList-CCkeSf_8.chunk.mjs","sources":["../node_modules/vue-material-design-icons/AccountMultipleOutline.vue","../src/components/Editor/AvatarWrapper.vue","../src/components/Editor/GuestNameDialog.vue","../src/components/Editor/SessionList.vue"],"sourcesContent":["<template>\n  <span v-bind=\"$attrs\"\n        :aria-hidden=\"title ? null : 'true'\"\n        :aria-label=\"title\"\n        class=\"material-design-icon account-multiple-outline-icon\"\n        role=\"img\"\n        @click=\"$emit('click', $event)\">\n    <svg :fill=\"fillColor\"\n         class=\"material-design-icon__svg\"\n         :width=\"size\"\n         :height=\"size\"\n         viewBox=\"0 0 24 24\">\n      <path d=\"M13.07 10.41A5 5 0 0 0 13.07 4.59A3.39 3.39 0 0 1 15 4A3.5 3.5 0 0 1 15 11A3.39 3.39 0 0 1 13.07 10.41M5.5 7.5A3.5 3.5 0 1 1 9 11A3.5 3.5 0 0 1 5.5 7.5M7.5 7.5A1.5 1.5 0 1 0 9 6A1.5 1.5 0 0 0 7.5 7.5M16 17V19H2V17S2 13 9 13 16 17 16 17M14 17C13.86 16.22 12.67 15 9 15S4.07 16.31 4 17M15.95 13A5.32 5.32 0 0 1 18 17V19H22V17S22 13.37 15.94 13Z\">\n        <title v-if=\"title\">{{ title }}</title>\n      </path>\n    </svg>\n  </span>\n</template>\n\n<script>\nexport default {\n  name: \"AccountMultipleOutlineIcon\",\n  emits: ['click'],\n  props: {\n    title: {\n      type: String,\n    },\n    fillColor: {\n      type: String,\n      default: \"currentColor\"\n    },\n    size: {\n      type: Number,\n      default: 24\n    }\n  }\n}\n</script>","<!--\n  - SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<div class=\"avatar-wrapper\" :style=\"sessionAvatarStyle\">\n\t\t<NcAvatar\n\t\t\tv-if=\"session.userId\"\n\t\t\t:user=\"session.userId ? session.userId : session.guestName\"\n\t\t\t:is-guest=\"session.userId === null\"\n\t\t\t:disable-menu=\"true\"\n\t\t\thide-status\n\t\t\t:disable-tooltip=\"true\"\n\t\t\t:size=\"size\" />\n\t\t<div v-else class=\"avatar\" :style=\"sessionBackgroundStyle\">\n\t\t\t{{ guestInitial }}\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport NcAvatar from '@nextcloud/vue/components/NcAvatar'\nexport default {\n\tname: 'AvatarWrapper',\n\tcomponents: {\n\t\tNcAvatar,\n\t},\n\tprops: {\n\t\tsession: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tsize: {\n\t\t\ttype: Number,\n\t\t\tdefault: () => 32,\n\t\t},\n\t},\n\tcomputed: {\n\t\tsessionAvatarStyle() {\n\t\t\treturn {\n\t\t\t\t...this.sessionBackgroundStyle,\n\t\t\t\t'border-color': this.session.color,\n\t\t\t\t'border-width': '2px',\n\t\t\t\t'border-style': 'solid',\n\t\t\t\t'--size': this.size + 'px',\n\t\t\t\t'--font-size': this.size / 2 + 'px',\n\t\t\t}\n\t\t},\n\t\tsessionBackgroundStyle() {\n\t\t\treturn {\n\t\t\t\t'background-color': this.session.userId\n\t\t\t\t\t? this.session.color + ' !important'\n\t\t\t\t\t: '#b9b9b9',\n\t\t\t}\n\t\t},\n\t\tguestInitial() {\n\t\t\treturn this.session.guestName === ''\n\t\t\t\t? '?'\n\t\t\t\t: this.session.guestName.slice(0, 1).toUpperCase()\n\t\t},\n\t},\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.avatar,\n.avatar-wrapper {\n\tborder-radius: 50%;\n\twidth: var(--size);\n\theight: var(--size);\n\ttext-align: center;\n\tcolor: #ffffff;\n\tline-height: var(--size);\n\tfont-size: var(--font-size);\n\tfont-weight: normal;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n}\n</style>\n","<!--\n  - SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<form\n\t\t:title=\"t('text', 'Enter your name so other people can see who is editing')\"\n\t\tclass=\"guest-name-dialog\"\n\t\t@submit.prevent=\"setGuestName()\">\n\t\t<label><AvatarWrapper :session=\"session\" :size=\"32\" /></label>\n\t\t<input\n\t\t\tv-model=\"guestName\"\n\t\t\ttype=\"text\"\n\t\t\t:aria-label=\"t('text', 'Edit guest name')\"\n\t\t\t:placeholder=\"t('text', 'Guest')\" />\n\t\t<input\n\t\t\ttype=\"submit\"\n\t\t\tclass=\"icon-confirm\"\n\t\t\t:aria-label=\"t('text', 'Save guest name')\"\n\t\t\tvalue=\"\" />\n\t</form>\n</template>\n\n<script>\nimport { showError, showWarning } from '@nextcloud/dialogs'\nimport { t } from '@nextcloud/l10n'\nimport { generateUrl } from '@nextcloud/router'\nimport { update } from '../../apis/connect.ts'\nimport { useConnection } from '../../composables/useConnection.ts'\nimport AvatarWrapper from './AvatarWrapper.vue'\n\nexport default {\n\tname: 'GuestNameDialog',\n\tcomponents: {\n\t\tAvatarWrapper,\n\t},\n\tprops: {\n\t\tsession: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tsetup() {\n\t\tconst { connection } = useConnection()\n\t\treturn { connection }\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tguestName: '',\n\t\t\tguestNameBuffered: '',\n\t\t}\n\t},\n\tcomputed: {\n\t\tavatarUrl() {\n\t\t\tconst size = 32\n\t\t\tconst avatarUrl = generateUrl('/avatar/guest/{user}/{size}', {\n\t\t\t\tuser: this.guestNameBuffered,\n\t\t\t\tsize,\n\t\t\t})\n\t\t\treturn window.location.protocol + '//' + window.location.host + avatarUrl\n\t\t},\n\t},\n\tbeforeMount() {\n\t\tthis.guestName = this.session.guestName\n\t\tthis.updateBufferedGuestName()\n\t},\n\n\tmethods: {\n\t\tsetGuestName() {\n\t\t\tif (!this.connection) {\n\t\t\t\tshowError(t('text', 'Not connected. Cannot update guest name.'))\n\t\t\t\treturn\n\t\t\t}\n\t\t\tconst previousGuestName = this.session.guestName\n\t\t\tupdate(this.guestName, this.connection)\n\t\t\t\t.then(() => {\n\t\t\t\t\tlocalStorage.setItem('nick', this.guestName)\n\t\t\t\t\tthis.updateBufferedGuestName()\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tconsole.warn('Failed to update the session', { error })\n\t\t\t\t\tshowWarning(t('text', 'Failed to update the guest name.'))\n\t\t\t\t\tthis.guestName = previousGuestName\n\t\t\t\t})\n\t\t},\n\t\tupdateBufferedGuestName() {\n\t\t\tthis.guestNameBuffered = this.guestName\n\t\t},\n\t\tt,\n\t},\n}\n</script>\n\n<style scoped lang=\"scss\">\nform.guest-name-dialog {\n\tdisplay: flex;\n\talign-items: center;\n\tpadding: 6px;\n\n\t&:deep(img) {\n\t\tmargin: 0 !important;\n\t}\n\n\tinput[type='text'] {\n\t\tflex-grow: 1;\n\t}\n\tlabel {\n\t\tpadding-right: 3px;\n\t\theight: 32px;\n\t}\n}\n</style>\n","<!--\n  - SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<NcPopover\n\t\t:no-focus-trap=\"!showGuestNameDialog\"\n\t\tclass=\"session-list\"\n\t\tplacement=\"bottom\">\n\t\t<template #trigger=\"{ attrs }\">\n\t\t\t<div>\n\t\t\t\t<NcButton\n\t\t\t\t\t:title=\"label\"\n\t\t\t\t\t:aria-label=\"label\"\n\t\t\t\t\ttype=\"tertiary\"\n\t\t\t\t\tclass=\"avatar-list\"\n\t\t\t\t\tv-bind=\"attrs\">\n\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t<AccountMultipleOutlineIcon :size=\"20\" />\n\t\t\t\t\t\t<AvatarWrapper\n\t\t\t\t\t\t\tv-for=\"session in sessionsVisible\"\n\t\t\t\t\t\t\t:key=\"session.id\"\n\t\t\t\t\t\t\t:session=\"session\"\n\t\t\t\t\t\t\t:size=\"28\" />\n\t\t\t\t\t</template>\n\t\t\t\t</NcButton>\n\t\t\t</div>\n\t\t</template>\n\t\t<template #default>\n\t\t\t<div class=\"session-menu\">\n\t\t\t\t<slot name=\"lastSaved\" />\n\t\t\t\t<ul>\n\t\t\t\t\t<GuestNameDialog\n\t\t\t\t\t\tv-if=\"showGuestNameDialog\"\n\t\t\t\t\t\t:session=\"currentSession\" />\n\t\t\t\t\t<li\n\t\t\t\t\t\tv-for=\"session in participantsPopover\"\n\t\t\t\t\t\t:key=\"session.id\"\n\t\t\t\t\t\t:style=\"avatarStyle(session)\">\n\t\t\t\t\t\t<AvatarWrapper :session=\"session\" :size=\"36\" />\n\t\t\t\t\t\t<span class=\"session-label\">\n\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\tsession.userId\n\t\t\t\t\t\t\t\t\t? session.displayName\n\t\t\t\t\t\t\t\t\t: session.guestName\n\t\t\t\t\t\t\t\t\t\t? session.guestName\n\t\t\t\t\t\t\t\t\t\t: t('text', 'Guest')\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span v-if=\"session.userId === null\" class=\"guest-label\"\n\t\t\t\t\t\t\t>({{ t('text', 'guest') }})</span\n\t\t\t\t\t\t>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t</template>\n\t</NcPopover>\n</template>\n\n<script>\nimport { t } from '@nextcloud/l10n'\nimport NcButton from '@nextcloud/vue/components/NcButton'\nimport NcPopover from '@nextcloud/vue/components/NcPopover'\nimport AccountMultipleOutlineIcon from 'vue-material-design-icons/AccountMultipleOutline.vue'\nimport { useEditorFlags } from '../../composables/useEditorFlags.ts'\nimport {\n\tCOLLABORATOR_DISCONNECT_TIME,\n\tCOLLABORATOR_IDLE_TIME,\n} from '../../services/SyncService.ts'\nimport AvatarWrapper from './AvatarWrapper.vue'\nimport GuestNameDialog from './GuestNameDialog.vue'\n\nexport default {\n\tname: 'SessionList',\n\tcomponents: {\n\t\tAccountMultipleOutlineIcon,\n\t\tAvatarWrapper,\n\t\tGuestNameDialog,\n\t\tNcButton,\n\t\tNcPopover,\n\t},\n\tprops: {\n\t\tsessions: {\n\t\t\ttype: Object,\n\t\t\tdefault: () => {\n\t\t\t\treturn {}\n\t\t\t},\n\t\t},\n\t},\n\tsetup() {\n\t\tconst { isPublic } = useEditorFlags()\n\t\treturn { isPublic }\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tmyName: '',\n\t\t}\n\t},\n\tcomputed: {\n\t\tlabel() {\n\t\t\treturn t('text', 'Active people')\n\t\t},\n\t\tparticipantsPopover() {\n\t\t\tif (this.currentSession?.guestName) {\n\t\t\t\treturn this.participantsWithoutCurrent\n\t\t\t}\n\t\t\treturn this.participants\n\t\t},\n\t\tparticipantsWithoutCurrent() {\n\t\t\treturn this.participants.filter((session) => !session.isCurrent)\n\t\t},\n\t\tparticipants() {\n\t\t\treturn Object.values(this.sessions)\n\t\t\t\t.filter(\n\t\t\t\t\t(session) =>\n\t\t\t\t\t\tsession.lastContact\n\t\t\t\t\t\t\t> Date.now() / 1000 - COLLABORATOR_DISCONNECT_TIME\n\t\t\t\t\t\t&& (session.userId !== null || session.guestName !== null),\n\t\t\t\t)\n\t\t\t\t.sort((a, b) => a.lastContact < b.lastContact)\n\t\t},\n\t\tshowGuestNameDialog() {\n\t\t\treturn (\n\t\t\t\tthis.isPublic && this.currentSession && !this.currentSession.userId\n\t\t\t)\n\t\t},\n\t\tcurrentSession() {\n\t\t\treturn Object.values(this.sessions).find((session) => session.isCurrent)\n\t\t},\n\t\tavatarStyle() {\n\t\t\treturn (session) => {\n\t\t\t\treturn {\n\t\t\t\t\topacity:\n\t\t\t\t\t\tsession.lastContact\n\t\t\t\t\t\t> Date.now() / 1000 - COLLABORATOR_IDLE_TIME\n\t\t\t\t\t\t\t? 1\n\t\t\t\t\t\t\t: 0.5,\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tsessionsVisible() {\n\t\t\treturn this.participantsWithoutCurrent.slice(0, 3)\n\t\t},\n\t},\n\tmethods: {\n\t\tt,\n\t},\n}\n</script>\n\n<style scoped lang=\"scss\">\n.session-list {\n\theight: var(--default-clickable-area);\n}\n\n.avatar-list {\n\twidth: min-content !important;\n\tpadding-inline: var(--default-grid-baseline);\n\n\t:deep(.button-vue__icon) {\n\t\tdisplay: inline-flex;\n\t\tflex-direction: row-reverse;\n\t\twidth: min-content;\n\n\t\t.avatar-wrapper {\n\t\t\tmargin: 3px -12px 3px 0;\n\t\t\tz-index: 1;\n\t\t\toverflow: hidden;\n\t\t}\n\t}\n}\n\n.session-menu {\n\tmax-width: 280px;\n\tpadding-top: 6px;\n\tpadding-bottom: 6px;\n\n\tul li {\n\t\talign-items: center;\n\t\tdisplay: flex;\n\t\tpadding: 6px;\n\n\t\t.avatar-wrapper {\n\t\t\theight: 36px;\n\t\t\twidth: 36px;\n\t\t\tmargin-right: 6px;\n\t\t}\n\n\t\t.session-label {\n\t\t\tpadding-right: 3px;\n\t\t}\n\n\t\t.guest-label {\n\t\t\tpadding-left: 3px;\n\t\t\tcolor: var(--color-text-maxcontrast);\n\t\t}\n\t}\n}\n\nlabel {\n\tdisplay: block;\n\tmargin: 8px;\n}\n\n.hint {\n\tmargin: 8px;\n\tcolor: var(--color-text-maxcontrast);\n}\n</style>\n"],"names":["_sfc_main","NcAvatar","AvatarWrapper","connection","useConnection","avatarUrl","generateUrl","showError","t","previousGuestName","update","error","showWarning","AccountMultipleOutlineIcon","GuestNameDialog","NcButton","NcPopover","isPublic","useEditorFlags","session","COLLABORATOR_DISCONNECT_TIME","a","b","COLLABORATOR_IDLE_TIME"],"mappings":"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","x_google_ignoreList":[0]}